name: iOS CI
2
3on:
4  push:
5    branches: [ main ]
6  pull_request:
7    branches: [ main ]
8
9jobs:
10  build:
11    runs-on: macos-latest
12    
13    steps:
14      # Checkout repo
15      - uses: actions/checkout@v4
16      
17      # Set up Xcode
18      - name: Set up Xcode
19        uses: maxim-lobanov/setup-xcode@v1
20        with:
21          xcode-version: 'latest-stable'
22      
23      # List available simulators (for debugging)
24      - name: List available simulators
25        run: xcrun simctl list devices available
26      
27      # Install dependencies
28      - name: Install SwiftLint
29        run: brew install swiftlint
30      
31      # Run SwiftLint in strict mode (fails build if any error)
32      - name: Run SwiftLint
33        run: swiftlint --strict
34      
35      # Run unit tests with iPhone 17 (fallback to latest available)
36      - name: Run Tests
37        run: |
38          # Try to find iPhone 17 first, then fall back to latest iPhone
39          DEVICE=$(xcrun simctl list devices available iPhone | grep -m 1 "iPhone 17" | sed -E 's/.*\(([^)]+)\).*/\1/' || \
40                   xcrun simctl list devices available iPhone | grep -m 1 "iPhone" | sed -E 's/.*\(([^)]+)\).*/\1/')
41          
42          echo "Using device: $DEVICE"
43          
44          xcodebuild test \
45            -scheme "LittleLemon" \
46            -destination "platform=iOS Simulator,id=$DEVICE" \
47            -enableCodeCoverage YES \
48            -resultBundlePath TestResults \
49            | xcpretty --color --report html
50      
51      # Upload test results
52      - name: Upload test results
53        if: always()
54        uses: actions/upload-artifact@v4
55        with:
56          name: test-results
57          path: TestResults